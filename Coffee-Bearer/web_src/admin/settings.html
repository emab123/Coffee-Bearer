<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - Cafeteira RFID</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="app-title">
                <div class="coffee-icon">‚òï</div>
                <div>
                    <h1>Cafeteira RFID - Admin</h1>
                    <p class="version">Configura√ß√µes do Sistema v4.0</p>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div>
                    <div class="user-name">Administrador</div>
                    <div class="user-role">Admin</div>
                </div>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </header>

        <nav class="app-nav">
            <ul class="nav-tabs">
                <li class="nav-tab"><a href="/admin/dashboard">Dashboard</a></li>
                <li class="nav-tab"><a href="/admin/users">Usu√°rios</a></li>
                <li class="nav-tab active"><a href="/admin/settings">Configura√ß√µes</a></li>
                <li class="nav-tab"><a href="/admin/logs">Logs</a></li>
                <li class="nav-tab"><a href="/admin/stats">Estat√≠sticas</a></li>
            </ul>
        </nav>

        <main class="app-main">
            <!-- Sistema de Alertas -->
            <div id="alertContainer"></div>

            <!-- Configura√ß√µes de Autentica√ß√£o -->
            <section class="auth-settings">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîê Configura√ß√µes de Autentica√ß√£o</h3>
                    </div>
                    <form id="authSettingsForm" class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="adminUsername">Usu√°rio Admin</label>
                            <input type="text" id="adminUsername" class="form-input" placeholder="admin" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="adminPassword">Nova Senha Admin</label>
                            <input type="password" id="adminPassword" class="form-input" placeholder="Deixe em branco para manter">
                            <small class="form-help">M√≠nimo 6 caracteres</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="adminPasswordConfirm">Confirmar Nova Senha</label>
                            <input type="password" id="adminPasswordConfirm" class="form-input" placeholder="Confirme a nova senha">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                üíæ Salvar Credenciais Admin
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Configura√ß√µes da Cafeteira -->
            <section class="coffee-settings">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚òï Configura√ß√µes da Cafeteira</h3>
                    </div>
                    <form id="coffeeSettingsForm" class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="maxCoffees">Capacidade M√°xima</label>
                            <input type="number" id="maxCoffees" class="form-input" min="10" max="500" value="100">
                            <small class="form-help">N√∫mero m√°ximo de caf√©s no recipiente</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="currentCoffees">Caf√©s Atuais</label>
                            <input type="number" id="currentCoffees" class="form-input" min="0" max="500">
                            <small class="form-help">Quantidade atual de caf√©s dispon√≠veis</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="serveTime">Tempo de Preparo (segundos)</label>
                            <input type="number" id="serveTime" class="form-input" min="3" max="30" value="8">
                            <small class="form-help">Tempo que o rel√© ficar√° ativo</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="cooldownTime">Cooldown (segundos)</label>
                            <input type="number" id="cooldownTime" class="form-input" min="1" max="10" value="3">
                            <small class="form-help">Tempo de espera entre leituras RFID</small>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                ‚öôÔ∏è Salvar Configura√ß√µes
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetCoffeeSettings()">
                                üîÑ Restaurar Padr√£o
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Configura√ß√µes de Usu√°rios -->
            <section class="user-settings">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üë• Configura√ß√µes de Usu√°rios</h3>
                    </div>
                    <form id="userSettingsForm" class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="initialCredits">Cr√©ditos Iniciais</label>
                            <input type="number" id="initialCredits" class="form-input" min="1" max="50" value="10">
                            <small class="form-help">Cr√©ditos dados a novos usu√°rios</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="maxUsers">M√°ximo de Usu√°rios</label>
                            <input type="number" id="maxUsers" class="form-input" min="10" max="200" value="50">
                            <small class="form-help">Limite m√°ximo de usu√°rios cadastrados</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="weeklyReset"> Reset Semanal Autom√°tico
                            </label>
                            <small class="form-help">Restaurar cr√©ditos automaticamente toda semana</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="resetDay">Dia do Reset</label>
                            <select id="resetDay" class="form-select">
                                <option value="0">Domingo</option>
                                <option value="1" selected>Segunda-feira</option>
                                <option value="2">Ter√ßa-feira</option>
                                <option value="3">Quarta-feira</option>
                                <option value="4">Quinta-feira</option>
                                <option value="5">Sexta-feira</option>
                                <option value="6">S√°bado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                üíæ Salvar Configura√ß√µes
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Configura√ß√µes de Sistema -->
            <section class="system-settings">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üñ•Ô∏è Configura√ß√µes do Sistema</h3>
                    </div>
                    <div class="settings-group">
                        <!-- LED Settings -->
                        <div class="form-group">
                            <label class="form-label" for="ledBrightness">Brilho do LED (%)</label>
                            <input type="range" id="ledBrightness" min="10" max="100" value="50" 
                                   oninput="updateLEDBrightness(this.value)">
                            <span id="brightnessValue">50%</span>
                        </div>

                        <!-- Audio Settings -->
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="audioEnabled" checked> Sons Habilitados
                            </label>
                        </div>

                        <!-- Log Settings -->
                        <div class="form-group">
                            <label class="form-label" for="logLevel">N√≠vel de Log</label>
                            <select id="logLevel" class="form-select">
                                <option value="0">Debug</option>
                                <option value="1" selected>Info</option>
                                <option value="2">Warning</option>
                                <option value="3">Error</option>
                                <option value="4">Critical</option>
                            </select>
                        </div>

                        <!-- Time Settings -->
                        <div class="form-group">
                            <label class="form-label" for="timezone">Fuso Hor√°rio</label>
                            <select id="timezone" class="form-select">
                                <option value="-12">GMT-12</option>
                                <option value="-11">GMT-11</option>
                                <option value="-10">GMT-10</option>
                                <option value="-9">GMT-9</option>
                                <option value="-8">GMT-8</option>
                                <option value="-7">GMT-7</option>
                                <option value="-6">GMT-6</option>
                                <option value="-5">GMT-5</option>
                                <option value="-4">GMT-4</option>
                                <option value="-3" selected>GMT-3 (Bras√≠lia)</option>
                                <option value="-2">GMT-2</option>
                                <option value="-1">GMT-1</option>
                                <option value="0">GMT (UTC)</option>
                                <option value="1">GMT+1</option>
                                <option value="2">GMT+2</option>
                                <option value="3">GMT+3</option>
                                <option value="4">GMT+4</option>
                                <option value="5">GMT+5</option>
                                <option value="6">GMT+6</option>
                                <option value="7">GMT+7</option>
                                <option value="8">GMT+8</option>
                                <option value="9">GMT+9</option>
                                <option value="10">GMT+10</option>
                                <option value="11">GMT+11</option>
                                <option value="12">GMT+12</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <button class="btn btn-primary" onclick="saveSystemSettings()">
                                üíæ Salvar Configura√ß√µes
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- A√ß√µes de Sistema -->
            <section class="system-actions">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîß A√ß√µes do Sistema</h3>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-info" onclick="testCoffeeSystem()">
                            ‚òï Testar Sistema
                        </button>
                        <button class="btn btn-warning" onclick="restartSystem()">
                            üîÑ Reiniciar Sistema
                        </button>
                        <button class="btn btn-secondary" onclick="backupData()">
                            üíæ Backup dos Dados
                        </button>
                        <button class="btn btn-secondary" onclick="showRestoreDialog()">
                            üìÇ Restaurar Backup
                        </button>
                        <button class="btn btn-danger" onclick="factoryReset()">
                            ‚ö†Ô∏è Reset de F√°brica
                        </button>
                    </div>
                </div>
            </section>

            <!-- Informa√ß√µes do Sistema -->
            <section class="system-info">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ÑπÔ∏è Informa√ß√µes do Sistema</h3>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Vers√£o do Firmware:</label>
                            <span id="firmwareVersion">4.0.0</span>
                        </div>
                        <div class="info-item">
                            <label>Uptime:</label>
                            <span id="systemUptime">Carregando...</span>
                        </div>
                        <div class="info-item">
                            <label>Mem√≥ria Livre:</label>
                            <span id="freeMemory">Carregando...</span>
                        </div>
                        <div class="info-item">
                            <label>WiFi:</label>
                            <span id="wifiInfo">Carregando...</span>
                        </div>
                        <div class="info-item">
                            <label>IP Local:</label>
                            <span id="localIP">Carregando...</span>
                        </div>
                        <div class="info-item">
                            <label>√öltima Inicializa√ß√£o:</label>
                            <span id="lastBoot">Carregando...</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Restaurar Backup -->
    <div id="restoreModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üìÇ Restaurar Backup</h3>
                <button class="modal-close" onclick="closeRestoreModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="backupFile">Selecionar Arquivo de Backup</label>
                    <input type="file" id="backupFile" class="form-input" accept=".json,.bak">
                    <small class="form-help">Selecione um arquivo de backup v√°lido (.json ou .bak)</small>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="overwriteUsers"> Sobrescrever usu√°rios existentes
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="restoreSettings"> Restaurar configura√ß√µes
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRestoreModal()">Cancelar</button>
                <button class="btn btn-warning" onclick="executeRestore()">Restaurar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmTitle">Confirmar A√ß√£o</h3>
                <button class="modal-close" onclick="closeConfirmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Tem certeza que deseja executar esta a√ß√£o?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancelar</button>
                <button class="btn btn-danger" id="confirmBtn" onclick="executeConfirmedAction()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <div class="loading-text">Processando...</div>
    </div>

    <script src="/js/app.js"></script>
    <script src="/js/admin.js"></script>
    
    <script>
        // Vari√°veis globais
        let currentSettings = {};
        let pendingAction = null;

        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initSettingsPage();
        });

        function initSettingsPage() {
            checkAuth();
            loadCurrentSettings();
            setupEventListeners();
            startStatusUpdate();
        }

        function setupEventListeners() {
            // Formul√°rio de autentica√ß√£o
            document.getElementById('authSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveAuthSettings();
            });

            // Formul√°rio da cafeteira
            document.getElementById('coffeeSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCoffeeSettings();
            });

            // Formul√°rio de usu√°rios
            document.getElementById('userSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserSettings();
            });

            // Slider de brilho
            document.getElementById('ledBrightness').addEventListener('input', function(e) {
                updateLEDBrightness(e.target.value);
            });
        }

        async function loadCurrentSettings() {
            try {
                showLoading(true);
                
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (data) {
                    currentSettings = data;
                    updateSettingsForm(data);
                    updateSystemInfo(data);
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
                showAlert('Erro ao carregar configura√ß√µes', 'error');
            } finally {
                showLoading(false);
            }
        }

        function updateSettingsForm(data) {
            // Configura√ß√µes da cafeteira
            if (data.coffee) {
                document.getElementById('currentCoffees').value = data.coffee.remaining || 0;
                document.getElementById('maxCoffees').value = data.coffee.maxCapacity || 100;
            }

            // Outras configura√ß√µes seriam carregadas aqui
            // Por exemplo, via endpoint espec√≠fico /api/settings
        }

        function updateSystemInfo(data) {
            if (data.system) {
                document.getElementById('systemUptime').textContent = formatUptime(data.system.uptime);
                document.getElementById('freeMemory').textContent = formatMemory(data.system.freeHeap);
                document.getElementById('wifiInfo').textContent = data.system.wifiConnected ? 'Conectado' : 'Desconectado';
                document.getElementById('localIP').textContent = data.system.wifiIP || 'N/A';
            }
        }

        async function saveAuthSettings() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('adminPasswordConfirm').value;

            if (!username) {
                showAlert('Nome de usu√°rio √© obrigat√≥rio', 'error');
                return;
            }

            if (password && password !== confirmPassword) {
                showAlert('As senhas n√£o coincidem', 'error');
                return;
            }

            if (password && password.length < 6) {
                showAlert('A senha deve ter pelo menos 6 caracteres', 'error');
                return;
            }

            try {
                showLoading(true);

                const requestBody = { username };
                if (password) {
                    requestBody.password = password;
                }

                const response = await fetch('/api/admin/credentials', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Credenciais atualizadas com sucesso!', 'success');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPasswordConfirm').value = '';
                } else {
                    showAlert(result.message || 'Erro ao atualizar credenciais', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar credenciais:', error);
                showAlert('Erro de conex√£o', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveCoffeeSettings() {
            const maxCoffees = parseInt(document.getElementById('maxCoffees').value);
            const currentCoffees = parseInt(document.getElementById('currentCoffees').value);
            const serveTime = parseInt(document.getElementById('serveTime').value);
            const cooldownTime = parseInt(document.getElementById('cooldownTime').value);

            if (currentCoffees > maxCoffees) {
                showAlert('Caf√©s atuais n√£o podem ser maiores que a capacidade m√°xima', 'error');
                return;
            }

            try {
                showLoading(true);

                const response = await fetch('/api/coffee/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        maxCoffees,
                        currentCoffees,
                        serveTime: serveTime * 1000, // Converter para ms
                        cooldownTime: cooldownTime * 1000 // Converter para ms
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Configura√ß√µes da cafeteira atualizadas!', 'success');
                } else {
                    showAlert(result.message || 'Erro ao atualizar configura√ß√µes', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showAlert('Erro de conex√£o', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveUserSettings() {
            const initialCredits = parseInt(document.getElementById('initialCredits').value);
            const maxUsers = parseInt(document.getElementById('maxUsers').value);
            const weeklyReset = document.getElementById('weeklyReset').checked;
            const resetDay = parseInt(document.getElementById('resetDay').value);

            try {
                showLoading(true);

                const response = await fetch('/api/users/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        initialCredits,
                        maxUsers,
                        weeklyReset,
                        resetDay
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Configura√ß√µes de usu√°rios atualizadas!', 'success');
                } else {
                    showAlert(result.message || 'Erro ao atualizar configura√ß√µes', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showAlert('Erro de conex√£o', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveSystemSettings() {
            const ledBrightness = parseInt(document.getElementById('ledBrightness').value);
            const audioEnabled = document.getElementById('audioEnabled').checked;
            const logLevel = parseInt(document.getElementById('logLevel').value);
            const timezone = parseInt(document.getElementById('timezone').value);

            try {
                showLoading(true);

                const response = await fetch('/api/system/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ledBrightness,
                        audioEnabled,
                        logLevel,
                        timezone
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Configura√ß√µes do sistema atualizadas!', 'success');
                } else {
                    showAlert(result.message || 'Erro ao atualizar configura√ß√µes', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showAlert('Erro de conex√£o', 'error');
            } finally {
                showLoading(false);
            }
        }

        function resetCoffeeSettings() {
            document.getElementById('maxCoffees').value = '100';
            document.getElementById('currentCoffees').value = '100';
            document.getElementById('serveTime').value = '8';
            document.getElementById('cooldownTime').value = '3';
            showAlert('Configura√ß√µes restauradas para o padr√£o', 'info');
        }

        function updateLEDBrightness(value) {
            document.getElementById('brightnessValue').textContent = value + '%';
            
            // Enviar comando para ESP32 atualizar brilho em tempo real
            fetch('/api/led/brightness', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ brightness: parseInt(value) })
            }).catch(e => console.error('Erro ao atualizar brilho:', e));
        }

        async function testCoffeeSystem() {
            showConfirmDialog(
                'Testar Sistema',
                'Isso ir√° servir um caf√© para teste. Confirmar?',
                async () => {
                    try {
                        showLoading(true);
                        const response = await fetch('/api/serve-coffee', { method: 'POST' });
                        const result = await response.json();
                        
                        if (result.success) {
                            showAlert('Sistema testado com sucesso!', 'success');
                        } else {
                            showAlert(result.message || 'Erro no teste', 'error');
                        }
                    } catch (error) {
                        showAlert('Erro de conex√£o no teste', 'error');
                    } finally {
                        showLoading(false);
                    }
                }
            );
        }

        function restartSystem() {
            showConfirmDialog(
                'Reiniciar Sistema',
                'O sistema ser√° reiniciado. Esta a√ß√£o pode levar alguns minutos. Confirmar?',
                async () => {
                    try {
                        showLoading(true);
                        await fetch('/api/system-reset', { method: 'POST' });
                        showAlert('Sistema reiniciando... Aguarde alguns instantes.', 'info');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 10000);
                    } catch (error) {
                        showAlert('Erro ao reiniciar sistema', 'error');
                        showLoading(false);
                    }
                }
            );
        }

        async function backupData() {
            try {
                showLoading(true);
                const response = await fetch('/api/backup');
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cafeteira_backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showAlert('Backup criado e baixado com sucesso!', 'success');
                } else {
                    showAlert('Erro ao criar backup', 'error');
                }
            } catch (error) {
                console.error('Erro no backup:', error);
                showAlert('Erro de conex√£o no backup', 'error');
            } finally {
                showLoading(false);
            }
        }

        function showRestoreDialog() {
            document.getElementById('restoreModal').classList.add('show');
        }

        function closeRestoreModal() {
            document.getElementById('restoreModal').classList.remove('show');
            document.getElementById('backupFile').value = '';
        }

        async function executeRestore() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Selecione um arquivo de backup', 'error');
                return;
            }

            const overwriteUsers = document.getElementById('overwriteUsers').checked;
            const restoreSettings = document.getElementById('restoreSettings').checked;

            try {
                showLoading(true);
                
                const formData = new FormData();
                formData.append('backup', file);
                formData.append('overwriteUsers', overwriteUsers);
                formData.append('restoreSettings', restoreSettings);

                const response = await fetch('/api/restore', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('Backup restaurado com sucesso!', 'success');
                    closeRestoreModal();
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showAlert(result.message || 'Erro ao restaurar backup', 'error');
                }
            } catch (error) {
                console.error('Erro na restaura√ß√£o:', error);
                showAlert('Erro de conex√£o na restaura√ß√£o', 'error');
            } finally {
                showLoading(false);
            }
        }

        function factoryReset() {
            showConfirmDialog(
                'Reset de F√°brica',
                'ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados (usu√°rios, configura√ß√µes, logs). Esta a√ß√£o √© IRREVERS√çVEL. Tem certeza?',
                () => {
                    showConfirmDialog(
                        'Confirmar Reset de F√°brica',
                        'Digite "CONFIRMAR" para prosseguir com o reset de f√°brica:',
                        async () => {
                            const confirmation = prompt('Digite "CONFIRMAR" para prosseguir:');
                            if (confirmation === 'CONFIRMAR') {
                                try {
                                    showLoading(true);
                                    await fetch('/api/factory-reset', { method: 'POST' });
                                    showAlert('Reset de f√°brica executado. Sistema reiniciando...', 'info');
                                    
                                    setTimeout(() => {
                                        location.href = '/login';
                                    }, 5000);
                                } catch (error) {
                                    showAlert('Erro no reset de f√°brica', 'error');
                                    showLoading(false);
                                }
                            } else {
                                showAlert('Reset cancelado', 'info');
                            }
                        }
                    );
                }
            );
        }

        function startStatusUpdate() {
            setInterval(() => {
                if (!document.hidden) {
                    loadCurrentSettings();
                }
            }, 30000);
        }

        function formatMemory(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / 1048576).toFixed(2) + ' MB';
        }
    </script>
</body>
</html>